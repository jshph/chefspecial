<html>
<head>
    <title>Sound Butler, at your service</title>
    <link rel="stylesheet" type="text/css" href="../main.css"/>
    <link rel="stylesheet" type="text/css" href="../soundcloud-custom-player/css/sc-player-minimal.css"/>
    <script src="http://connect.soundcloud.com/sdk.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="../soundcloud-custom-player/js/sc-player.js"></script>
    <script src="../soundcloud-custom-player/js/soundcloud.player.api.js"></script>
    <script>
        SC.initialize({
            //MAC:
            client_id: '8077356610fc30a730afebd4e4c8b422',
            redirect_uri: 'http://localhost:8888/chefspecial/test.html'
            //WINDOWS:
            //client_id: 'd8fef5dfa959bb728846bcb61636f77a',
            //redirect_uri: 'http://localhost/chefspecial/test.html'
        });

        /*function getUserPlaylist () {
            $("button").on('click', function(){
                var newPlaylist = prompt("Playlist Name:");
                return newPlaylist;
            });
        };*/

        /*function addUserPlaylist () {
            SC.get('/playlists/newPlaylist', function(track) {
                SC.oEmbed(track.permalink_url, document.getElementById('displayContainer'));
            });
        }; */
        

        //var trackList = [];
       /* $(document).ready(function() {
          
            SC.get('/playlists/electronic', function(track) {

            //for each track in trackList, perform GET request to favoriters to search their favorited tracks
            // final display of soundcloud widget
                SC.oEmbed(track.permalink_url, document.getElementById('displayContainer'));
            }); */
        
        //already inside a GET request of /me
        function addSongs(playlist) {
            var nicheTracks = [];
            var numTracks = 300;
            SC.get('/tracks', { limit: numTracks, q: playlist.genre, license: 'cc-by-sa'}, function(tracks) {
                $('.post').empty();
                $('.post').append($("<p>You might also want to check out</p>"));
                $(tracks).each(function(index, track) {
                    var tags = ["heavy", "smooth", "melancholic", "nostalgic"];
                    $('.post').append($("<div class='sugTrack' id='track_" + index + "'></div>"));
                    if (track.playback_count < 40) {
                        nicheTracks.push(track);
                        //var $embed = "div"
                        SC.oEmbed(track.permalink_url, {maxheight: '150px'}, document.getElementById("track_" + index));
                    }
                });
            });

            for (var i = 0; i < nicheTracks.length; i++) {
                console.log(nicheTracks[i].title + " " + nicheTracks[i].playback_count);
            }

        }


        $(document).ready(function(){
           $('a.connect').on('click', function(e){
                e.preventDefault();
                SC.connect(function(){
                    SC.get('/me', function(me){
                        $('#username').html(me.username);
                    });
                    SC.get('/me/playlists/', function(playlists) {
                        //$('#username').html(me.username);
                        $(playlists).each(function(index, playlist) {
                            //console.log(playlist.permalink_url);
                            var ele = $("<button>")//.data("arrayIndex", index)
                                            .on("click", function() {
                                                //playlist process and render here
                                                addSongs(playlist);
                                                //var foundSongs = [144437169];
                                                SC.put(playlist.uri, { playlist: { tracks: [144437169] } });
                                                SC.oEmbed(playlist.permalink_url, document.getElementById('displayContainer'));
                                            });
                            $('.playlistWrapper').append(ele);
                            $(ele).html(playlist.title);
                        });
                        
                        //addUserPlaylist();
                    });
                });
            });
        });
            
                /*$('a.connect').on('click', function(e) {
                    e.preventDefault();
                    SC.connect(function(){
                    SC.get('/me', function(me) {
                        $('#username').html(me.username);
                    SC.isConnected();   
                    });
                });
              }); */    
            
   // });


/* $(document).ready(function() {
  SC.get('/tracks', { genres: 'hiphop', shared_to_count: 1}, function(tracks) {
  $(tracks).each(function(index, track) {
  $('#results').append($('<li></li>').html(track.title + ' - ' + track.genre));
   });
  });
}); */
</script>



</head>
<body>
    <div class="wrapper">
        
        <h1>Chef's Special</h1>
        <a href="#" class="connect">Connect With SoundCloud</a>
        <p>Welcome <span id="username"></span></p>
        <!-- <button id="addPlaylist">Add a Playlist</button> -->
        </br>
        <div class="playlistWrapper"></div>
        <div class="songsContainer" id="displayContainer"></div>
       <!--  <div id="suggestedSongsContainer"></div> -->
        <div class="post"></div>

        

        </div>
    
        
    
</body>









  <!--for (var i = 0; i < playlist.tracks.length; i++) {
    //console.log(playlist.tracks[i].permalink_url);
    trackList.push(playlist.tracks[i].permalink_url);
  }

  //trackList updated now
    for (var i = 0; i < trackList.length; i++) {
        SC.oEmbed(trackList[i], document.getElementById('displayContainer'));
    }-->